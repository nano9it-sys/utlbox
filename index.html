<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sentence Case Character Counter</title>
<style>
body { font-family: Arial, sans-serif; background: #f2f4f8; display: flex; justify-content: center; padding: 30px; transition: background 0.3s, color 0.3s; }
body.dark { background: #1a1a1a; color: white; }
.app-container { width: 850px; background: #fff; padding: 0; border-radius: 15px; overflow: hidden; box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
body.dark .app-container { background: #222; }
.header-bar { background: #007bff; padding: 18px 20px 8px; color: #fff; display: flex; align-items: center; justify-content: space-between; }
.header-title { font-size: 28px; font-weight: 900; margin: 0; }
#langSelectHeader { height: 30px; border-radius: 5px; font-size: 14px; padding: 2px 5px; }

/* Toolbar */
.toolbar { background: #007bff; padding: 12px 20px; display: flex; flex-wrap: nowrap; gap: 10px; align-items: center; color: #fff; overflow-x: auto; }
select, button, #charBox { height: 40px; padding: 0 12px; border-radius: 8px; font-weight: bold; font-size: 15px; border: none; }
select { border: 2px solid black; }
button { background: white; cursor: pointer; border: 2px solid #ccc; }
#clearBtn { color: red; }
#charBox { background: #ffeb3b; color: #007bff; text-transform: capitalize; box-shadow: 0 3px 8px rgba(0,0,0,0.2); font-weight: bold; display: flex; align-items: center; }
.toggle-label { display: flex; align-items: center; gap: 5px; font-weight: bold; }

/* Textarea & Highlight */
.textarea-wrapper { position: relative; width: 100%; max-height: 400px; }
#highlightLayer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; padding: 20px; white-space: pre-wrap; word-wrap: break-word; color: transparent; z-index: 1; line-height: 1.5; box-sizing: border-box; font-size:17px; font-family:inherit; }
#textInput { position: relative; width: 100%; height: 300px; padding: 20px; border: none; border-top: 2px solid #ddd; font-size: 17px; line-height: 1.5; resize: vertical; outline: none; background: transparent; color: #000; z-index: 2; box-sizing: border-box; }
body.dark #textInput { color:#fff; border-color:#444; }

/* Stats */
.stats-bar { background: #007bff; padding: 15px; display: flex; justify-content: space-around; color: #fff; font-size: 16px; font-weight: bold; }

/* Duplicates panel */
.duplicates-panel { background: #e3f2fd; padding: 10px 15px; border-top: 2px solid #007bff; font-size: 14px; color: #000; }
body.dark .duplicates-panel { background: #333; color: #fff; }
.duplicates-panel b { color: red; }
.dup-table-wrapper { max-height: 150px; overflow-y: auto; margin-top: 5px; }
.dup-table-wrapper table { width: 100%; border-collapse: collapse; font-size: 13px; }
.dup-table-wrapper th, .dup-table-wrapper td { border: 1px solid #007bff; padding: 5px; text-align: left; }
.dup-table-wrapper th { background: #007bff; color: white; position: sticky; top: 0; z-index: 2; }
body.dark .dup-table-wrapper th { background: #555; color: #fff; }

@media (max-width: 600px) {
  .toolbar { flex-wrap: wrap; }
  select, button, #charBox { width: 100%; justify-content: center; }
}
.copy-tooltip {
  visibility: hidden;
  background-color: #4caf50;
  color: white;
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 13px;
  position: absolute;
  opacity: 0;
  transition: opacity 0.3s;
  pointer-events: none;
  z-index: 1000;
}
.copy-tooltip.show {
  visibility: visible;
  opacity: 1;
}
</style>
</head>
<body>
<div class="app-container">

<div class="header-bar">
  <div class="header-title" id="headerTitle">Sentence Case Character Counter</div>
  <select id="langSelectHeader" aria-label="Language selector">
    <option value="en">English</option>
    <option value="es">Spanish</option>
    <option value="fr">French</option>
    <option value="de">German</option>
    <option value="hi">Hindi</option>
    <option value="zh-CN">Chinese</option>
    <option value="ja">Japanese</option>
    <option value="ru">Russian</option>
    <option value="ar">Arabic</option>
    <option value="pt">Portuguese</option>
  </select>
</div>

<div class="toolbar">
  <select id="caseSelect" aria-label="Case transform">
    <option value="sentence">Sentence case</option>
    <option value="lower">lowercase</option>
    <option value="upper">UPPERCASE</option>
    <option value="capital">Capitalize Each Word</option>
    <option value="toggle">tOGGLE cASE</option>
  </select>

  <button id="clearBtn">Clear</button>
  <div id="charBox">0 characters</div>

  <button id="copyBtn">Copy</button>
<span id="copyTooltip" class="copy-tooltip">Copied!</span>

  <select id="downloadFormat" aria-label="Download format">
    <option value="txt">Text (.txt)</option>
    <option value="pdf">PDF (.pdf)</option>
    <option value="doc">Word (.docx)</option>
    <option value="xlsx">Excel (.xlsx)</option>
  </select>
  <button id="downloadBtn">Download</button>

  <label class="toggle-label">
    <input type="checkbox" id="darkToggle"> <span id="darkLabel">Dark</span>
  </label>
</div>

<div class="textarea-wrapper">
  <div id="highlightLayer"></div>
  <textarea id="textInput" placeholder="Type your text here..."></textarea>
</div>

<div class="stats-bar" id="statsBar">
  <span id="label_chars">CHARS <b id="s_chars">0</b></span>
  <span id="label_words">WORDS <b id="s_words">0</b></span>
  <span id="label_sent">SENTENCES <b id="s_sent">0</b></span>
  <span id="label_para">PARA <b id="s_para">0</b></span>
  <span id="label_space">SPACES <b id="s_space">0</b></span>
</div>

<div class="duplicates-panel">
  <span id="dupLabel">Duplicate Words Count: <b id="dup_count">0</b></span>
  <div class="dup-table-wrapper">
    <table id="dup_table">
      <thead>
        <tr><th id="dup_th_word">Word</th><th id="dup_th_count">Count</th></tr>
      </thead>
      <tbody><tr><td colspan="2" id="noDuplicatesText">No duplicates</td></tr></tbody>
    </table>
  </div>
</div>

<!-- keep libs for download/export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
// ----------------------
// TRANSLATIONS (local)
// ----------------------
const translations = {
  "en": {
    headerTitle: "Sentence Case Character Counter",
    placeholder: "Type your text here...",
    clearBtn: "Clear",
    copyBtn: "Copy",
    copyTooltip: "Copied!",
    downloadBtn: "Download",
    darkLabel: "Dark",
    caseOptions: {
      sentence: "Sentence case",
      lower: "lowercase",
      upper: "UPPERCASE",
      capital: "Capitalize Each Word",
      toggle: "tOGGLE cASE"
    },
    downloadOptions: { txt:"Text (.txt)", pdf:"PDF (.pdf)", doc:"Word (.docx)", xlsx:"Excel (.xlsx)" },
    stats: { chars:"CHARS", words:"WORDS", sent:"SENTENCES", para:"PARA", space:"SPACES" },
    dupLabel: "Duplicate Words Count:",
    dupTable: { word:"Word", count:"Count", nodups:"No duplicates" }
  },
  "es": {
    headerTitle: "Contador de Caracteres (May√∫sculas de Oraci√≥n)",
    placeholder: "Escribe tu texto aqu√≠...",
    clearBtn: "Limpiar",
    copyBtn: "Copiar",
    copyTooltip: "¬°Copiado!",
    downloadBtn: "Descargar",
    darkLabel: "Oscuro",
    caseOptions: { sentence:"Oraci√≥n", lower:"min√∫sculas", upper:"MAY√öSCULAS", capital:"Capitalizar Cada Palabra", toggle:"cAMBIO dE mAY√öSCULAS" },
    downloadOptions: { txt:"Texto (.txt)", pdf:"PDF (.pdf)", doc:"Word (.docx)", xlsx:"Excel (.xlsx)" },
    stats: { chars:"CAR", words:"PALABRAS", sent:"ORACIONES", para:"P√ÅRRAFOS", space:"ESPACIOS" },
    dupLabel: "Cantidad de Palabras Duplicadas:",
    dupTable: { word:"Palabra", count:"Cuenta", nodups:"Sin duplicados" }
  },
  "fr": {
    headerTitle: "Compteur de Caract√®res (Casse Phrase)",
    placeholder: "Tapez votre texte ici...",
    clearBtn: "Effacer",
    copyBtn: "Copier",
    copyTooltip: "Copi√© !",
    downloadBtn: "T√©l√©charger",
    darkLabel: "Sombre",
    caseOptions: { sentence:"Casse phrase", lower:"minuscules", upper:"MAJUSCULES", capital:"Mettre en majuscule chaque mot", toggle:"mODIFIER lA cASSE" },
    downloadOptions: { txt:"Texte (.txt)", pdf:"PDF (.pdf)", doc:"Word (.docx)", xlsx:"Excel (.xlsx)" },
    stats: { chars:"CAR", words:"MOTS", sent:"PHRASES", para:"PARA", space:"ESPACES" },
    dupLabel: "Nombre de Mots Dupliqu√©s:",
    dupTable: { word:"Mot", count:"Nombre", nodups:"Pas de doublons" }
  },
  "de": {
    headerTitle: "Zeichenz√§hler (Satzfall)",
    placeholder: "Geben Sie hier Ihren Text ein...",
    clearBtn: "L√∂schen",
    copyBtn: "Kopieren",
    copyTooltip: "Kopiert!",
    downloadBtn: "Herunterladen",
    darkLabel: "Dunkel",
    caseOptions: { sentence:"Satzfall", lower:"kleinschreibung", upper:"GROSSSCHREIBUNG", capital:"Jedes Wort gro√üschreiben", toggle:"Wechseln Fall" },
    downloadOptions: { txt:"Text (.txt)", pdf:"PDF (.pdf)", doc:"Word (.docx)", xlsx:"Excel (.xlsx)" },
    stats: { chars:"ZEICH", words:"W√ñRTER", sent:"S√ÑTZE", para:"ABS", space:"LEERR√ÑUME" },
    dupLabel: "Anzahl doppelter W√∂rter:",
    dupTable: { word:"Wort", count:"Anzahl", nodups:"Keine Duplikate" }
  },
  "hi": {
    headerTitle: "‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§ï‡•á‡§∏ ‡§ï‡•à‡§∞‡•á‡§ï‡•ç‡§ü‡§∞ ‡§ï‡§æ‡§â‡§Ç‡§ü‡§∞",
    placeholder: "‡§Ö‡§™‡§®‡§æ ‡§™‡§æ‡§† ‡§Ø‡§π‡§æ‡§Å ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç...",
    clearBtn: "‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç",
    copyBtn: "‡§ï‡•â‡§™‡•Ä",
    copyTooltip: "‡§ï‡•â‡§™‡•Ä ‡§ï‡§ø‡§Ø‡§æ!",
    downloadBtn: "‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°",
    darkLabel: "‡§°‡§æ‡§∞‡•ç‡§ï",
    caseOptions: { sentence:"‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§ï‡•á‡§∏", lower:"‡§õ‡•ã‡§ü‡•á ‡§Ö‡§ï‡•ç‡§∑‡§∞", upper:"‡§¨‡§°‡§º‡•á ‡§Ö‡§ï‡•ç‡§∑‡§∞", capital:"‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§∂‡§¨‡•ç‡§¶ ‡§ï‡•ã ‡§¨‡§°‡§º‡§æ ‡§ï‡§∞‡•á‡§Ç", toggle:"‡§ü‡•â‡§ó‡§≤ ‡§ï‡•á‡§∏" },
    downloadOptions: { txt:"‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü (.txt)", pdf:"PDF (.pdf)", doc:"Word (.docx)", xlsx:"Excel (.xlsx)" },
    stats: { chars:"‡§Ö‡§ï‡•ç‡§∑‡§∞", words:"‡§∂‡§¨‡•ç‡§¶", sent:"‡§µ‡§æ‡§ï‡•ç‡§Ø", para:"‡§™‡•à‡§∞‡•ç‡§∞‡§æ", space:"‡§∏‡•ç‡§™‡•á‡§∏" },
    dupLabel: "‡§°‡•Å‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§ü ‡§∂‡§¨‡•ç‡§¶‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ:",
    dupTable: { word:"‡§∂‡§¨‡•ç‡§¶", count:"‡§ó‡§ø‡§®‡§§‡•Ä", nodups:"‡§ï‡•ã‡§à ‡§°‡•Å‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç" }
  },
  "zh-CN": {
    headerTitle: "Âè•Â≠êÂ§ßÂ∞èÂÜôÂ≠óÁ¨¶ËÆ°Êï∞Âô®",
    placeholder: "Âú®Ê≠§Â§ÑËæìÂÖ•ÊñáÊú¨...",
    clearBtn: "Ê∏ÖÈô§",
    copyBtn: "Â§çÂà∂",
    copyTooltip: "Â∑≤Â§çÂà∂ÔºÅ",
    downloadBtn: "‰∏ãËΩΩ",
    darkLabel: "Ê∑±Ëâ≤",
    caseOptions: { sentence:"Âè•Â≠êÂ§ßÂ∞èÂÜô", lower:"Â∞èÂÜô", upper:"Â§ßÂÜô", capital:"ÊØèËØçÈ¶ñÂ≠óÊØçÂ§ßÂÜô", toggle:"ÂàáÊç¢Â§ßÂ∞èÂÜô" },
    downloadOptions: { txt:"ÊñáÊú¨ (.txt)", pdf:"PDF (.pdf)", doc:"Word (.docx)", xlsx:"Excel (.xlsx)" },
    stats: { chars:"Â≠óÁ¨¶", words:"ÂçïËØç", sent:"Âè•Â≠ê", para:"ÊÆµËêΩ", space:"Á©∫Ê†º" },
    dupLabel: "ÈáçÂ§çËØçËÆ°Êï∞Ôºö",
    dupTable: { word:"ÂçïËØç", count:"Ê¨°Êï∞", nodups:"Êó†ÈáçÂ§ç" }
  },
  "ja": {
    headerTitle: "ÊñáÈ†≠Â§ßÊñáÂ≠ó„Ç´„Ç¶„É≥„Çø„Éº",
    placeholder: "„Åì„Åì„Å´„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ...",
    clearBtn: "„ÇØ„É™„Ç¢",
    copyBtn: "„Ç≥„Éî„Éº",
    copyTooltip: "„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ",
    downloadBtn: "„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ",
    darkLabel: "„ÉÄ„Éº„ÇØ",
    caseOptions: { sentence:"ÊñáÈ†≠Â§ßÊñáÂ≠ó", lower:"Â∞èÊñáÂ≠ó", upper:"Â§ßÊñáÂ≠ó", capital:"ÂçòË™û„Åî„Å®„Å´Â§ßÊñáÂ≠ó", toggle:"„Ç±„Éº„ÇπÂàáÊõø" },
    downloadOptions: { txt:"„ÉÜ„Ç≠„Çπ„Éà (.txt)", pdf:"PDF (.pdf)", doc:"Word (.docx)", xlsx:"Excel (.xlsx)" },
    stats: { chars:"ÊñáÂ≠ó", words:"ÂçòË™û", sent:"Êñá", para:"ÊÆµËêΩ", space:"„Çπ„Éö„Éº„Çπ" },
    dupLabel: "ÈáçË§áÂçòË™ûÊï∞Ôºö",
    dupTable: { word:"ÂçòË™û", count:"ÂõûÊï∞", nodups:"ÈáçË§á„Å™„Åó" }
  },
  "ru": {
    headerTitle: "–°—á—ë—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ (—Ä–µ—á–µ–Ω–∏–µ)",
    placeholder: "–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å...",
    clearBtn: "–û—á–∏—Å—Ç–∏—Ç—å",
    copyBtn: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
    copyTooltip: "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!",
    downloadBtn: "–°–∫–∞—á–∞—Ç—å",
    darkLabel: "–¢—ë–º–Ω—ã–π",
    caseOptions: { sentence:"–†–µ—á. —Ä–µ–≥–∏—Å—Ç—Ä", lower:"—Å—Ç—Ä–æ—á–Ω—ã–µ", upper:"–ó–ê–ì–õ–ê–í–ù–´–ï", capital:"–°–¥–µ–ª–∞—Ç—å –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π", toggle:"–ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä" },
    downloadOptions: { txt:"–¢–µ–∫—Å—Ç (.txt)", pdf:"PDF (.pdf)", doc:"Word (.docx)", xlsx:"Excel (.xlsx)" },
    stats: { chars:"–°–ò–ú–í", words:"–°–õ–û–í–ê", sent:"–ü–†–ï–î–õ", para:"–ü–ê–†–ê", space:"–ü–†–û–ë–ï–õ–´" },
    dupLabel: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–ª–æ–≤:",
    dupTable: { word:"–°–ª–æ–≤–æ", count:"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ", nodups:"–ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤" }
  },
  "ar": {
    headerTitle: "ÿπÿØÿßÿØ ÿ£ÿ≠ÿ±ŸÅ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ¨ŸÖŸÑÿ©",
    placeholder: "ÿßŸÉÿ™ÿ® ÿßŸÑŸÜÿµ ŸáŸÜÿß...",
    clearBtn: "ŸÖÿ≥ÿ≠",
    copyBtn: "ŸÜÿ≥ÿÆ",
    copyTooltip: "ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ!",
    downloadBtn: "ÿ™ÿ≠ŸÖŸäŸÑ",
    darkLabel: "ÿØÿßŸÉŸÜ",
    caseOptions: { sentence:"ÿ≠ÿßŸÑÿ© ÿßŸÑÿ¨ŸÖŸÑÿ©", lower:"ÿ£ÿ≠ÿ±ŸÅ ÿµÿ∫Ÿäÿ±ÿ©", upper:"ÿ£ÿ≠ÿ±ŸÅ ŸÉÿ®Ÿäÿ±ÿ©", capital:"ÿ™ŸÉÿ®Ÿäÿ± ŸÉŸÑ ŸÉŸÑŸÖÿ©", toggle:"ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿ≠ÿßŸÑÿ©" },
    downloadOptions: { txt:"ŸÜÿµ (.txt)", pdf:"PDF (.pdf)", doc:"Word (.docx)", xlsx:"Excel (.xlsx)" },
    stats: { chars:"ÿ≠ÿ±ŸàŸÅ", words:"ŸÉŸÑŸÖÿßÿ™", sent:"ÿ¨ŸÖŸÑ", para:"ŸÅŸÇÿ±ÿßÿ™", space:"ŸÖÿ≥ÿßŸÅÿßÿ™" },
    dupLabel: "ÿπÿØÿØ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖŸÉÿ±ÿ±ÿ©:",
    dupTable: { word:"ŸÉŸÑŸÖÿ©", count:"ÿßŸÑÿπÿØÿØ", nodups:"ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ŸÉÿ±ÿßÿ±ÿßÿ™" }
  },
  "pt": {
    headerTitle: "Contador de Caracteres (Caso de Senten√ßa)",
    placeholder: "Digite seu texto aqui...",
    clearBtn: "Limpar",
    copyBtn: "Copiar",
    copyTooltip: "Copiado!",
    downloadBtn: "Baixar",
    darkLabel: "Escuro",
    caseOptions: { sentence:"Caso de senten√ßa", lower:"min√∫sculas", upper:"MAI√öSCULAS", capital:"Capitalizar Cada Palavra", toggle:"Alternar Caso" },
    downloadOptions: { txt:"Texto (.txt)", pdf:"PDF (.pdf)", doc:"Word (.docx)", xlsx:"Excel (.xlsx)" },
    stats: { chars:"CAR", words:"PALAVRAS", sent:"FRASES", para:"PARA", space:"ESPA√áOS" },
    dupLabel: "Contagem de Palavras Duplicadas:",
    dupTable: { word:"Palavra", count:"Contagem", nodups:"Sem duplicatas" }
  }
};

// ----------------------
// Elements
// ----------------------
const txt = document.getElementById("textInput");
const sel = document.getElementById("caseSelect");
const charBox = document.getElementById("charBox");
const darkToggle = document.getElementById("darkToggle");
const s_chars = document.getElementById("s_chars");
const s_words = document.getElementById("s_words");
const s_sent = document.getElementById("s_sent");
const s_para = document.getElementById("s_para");
const s_space = document.getElementById("s_space");
const dup_count = document.getElementById("dup_count");
const dup_table = document.getElementById("dup_table").querySelector("tbody");
const highlightLayer = document.getElementById("highlightLayer");
const langSelectHeader = document.getElementById("langSelectHeader");
const headerTitle = document.getElementById("headerTitle");
const clearBtn = document.getElementById("clearBtn");
const copyBtn = document.getElementById("copyBtn");
const downloadBtn = document.getElementById("downloadBtn");
const downloadFormat = document.getElementById("downloadFormat");
const darkLabelSpan = document.getElementById("darkLabel");
const copyTooltip = document.getElementById("copyTooltip");
const label_chars = document.getElementById("label_chars");
const label_words = document.getElementById("label_words");
const label_sent = document.getElementById("label_sent");
const label_para = document.getElementById("label_para");
const label_space = document.getElementById("label_space");
const dupLabelSpan = document.getElementById("dupLabel");
const dup_th_word = document.getElementById("dup_th_word");
const dup_th_count = document.getElementById("dup_th_count");
const noDuplicatesText = document.getElementById("noDuplicatesText");

// ----------------------
// Case functions
// ----------------------
function sentenceCase(t){ t=t.toLowerCase(); return t.replace(/(^\s*[a-z])|([.!?]\s*[a-z])/g,m=>m.toUpperCase()); }
function lower(t){ return t.toLowerCase(); }
function upper(t){ return t.toUpperCase(); }
function capital(t){ return t.replace(/\b(\w)(\w*)/g,(_,a,b)=>a.toUpperCase()+b.toLowerCase()); }
function toggleCase(t){ return t.split("").map(c=>c===c.toUpperCase()?c.toLowerCase():c.toUpperCase()).join(""); }
function applyCase(text){ switch(sel.value){ case"sentence":return sentenceCase(text); case"lower":return lower(text); case"upper":return upper(text); case"capital":return capital(text); case"toggle":return toggleCase(text);} return text; }

// ----------------------
// Stats & duplicates
// ----------------------
function updateStats(){ const t = txt.value;
  s_chars.textContent = t.length;
  s_words.textContent = t.trim() ? t.trim().split(/\s+/).length : 0;
  s_sent.textContent = t.split(/[.!?]+/).filter(Boolean).length;
  s_para.textContent = t.split(/\n+/).filter(Boolean).length;
  s_space.textContent = (t.match(/ /g)||[]).length;
  charBox.textContent = t.length + " characters";
  updateDuplicates(t);
}

function highlightDuplicates(text){
  const words = text.toLowerCase().match(/\b\w+\b/g) || [];
  const counts = {}; words.forEach(w=>counts[w]=(counts[w]||0)+1);
  let highlighted = text.replace(/\b\w+\b/g, word=>{
    return counts[word.toLowerCase()]>1 ? `<mark style="background:yellow;color:black;">${word}</mark>` : word;
  });
  highlighted = highlighted.replace(/\n/g,'<br>').replace(/ /g,'&nbsp;');
  highlightLayer.innerHTML = highlighted;
}

function updateDuplicates(text){
  const words = text.toLowerCase().match(/\b\w+\b/g) || [];
  const counts = {}; words.forEach(w=>counts[w]=(counts[w]||0)+1);
  const duplicates = Object.keys(counts).filter(k=>counts[k]>1);
  dup_count.textContent = duplicates.length;
  dup_table.innerHTML = "";
  if(duplicates.length){
    duplicates.forEach(w=>{
      const tr = document.createElement("tr");
      const tdW = document.createElement("td"); tdW.textContent = w;
      const tdC = document.createElement("td"); tdC.textContent = counts[w];
      tr.appendChild(tdW); tr.appendChild(tdC);
      dup_table.appendChild(tr);
    });
  } else {
    const tr = document.createElement("tr");
    const td = document.createElement("td"); td.colSpan = 2; td.textContent = translations[currentLang] ? translations[currentLang].dupTable.nodups : "No duplicates";
    tr.appendChild(td); dup_table.appendChild(tr);
  }
  highlightDuplicates(text);
}

// ----------------------
// Events
// ----------------------
sel.addEventListener("change", ()=>{
  const s = txt.selectionStart, e = txt.selectionEnd;
  txt.value = applyCase(txt.value);
  txt.setSelectionRange(s,e);
  updateStats();
});
txt.addEventListener("input", ()=>{
  const s = txt.selectionStart, e = txt.selectionEnd;
  if(sel.value === "sentence"){
    const updated = applyCase(txt.value);
    if(updated !== txt.value){
      txt.value = updated;
      txt.setSelectionRange(s,e);
    }
  }
  updateStats();
});
txt.addEventListener("compositionstart", ()=>composing=true);
txt.addEventListener("compositionend", ()=>composing=false);
document.getElementById("clearBtn").addEventListener("click", ()=>{ txt.value = ""; updateStats(); });

// COPY
copyBtn.addEventListener("click", () => {
  const textToCopy = txt.value;
  navigator.clipboard.writeText(textToCopy).then(() => {
    const rect = copyBtn.getBoundingClientRect();
    copyTooltip.style.top = rect.top - 35 + window.scrollY + "px";
    copyTooltip.style.left = rect.left + window.scrollX + "px";
    copyTooltip.textContent = translations[currentLang] ? translations[currentLang].copyTooltip : "Copied!";
    copyTooltip.classList.add("show");
    setTimeout(() => { copyTooltip.classList.remove("show"); }, 2000);
  }).catch(() => {
    const temp = document.createElement("textarea");
    temp.value = textToCopy;
    document.body.appendChild(temp);
    temp.select();
    document.execCommand("copy");
    document.body.removeChild(temp);

    copyTooltip.style.top = copyBtn.getBoundingClientRect().top - 35 + window.scrollY + "px";
    copyTooltip.style.left = copyBtn.getBoundingClientRect().left + window.scrollX + "px";
    copyTooltip.textContent = translations[currentLang] ? translations[currentLang].copyTooltip : "Copied!";
    copyTooltip.classList.add("show");
    setTimeout(() => copyTooltip.classList.remove("show"), 2000);
  });
});

// DOWNLOAD
document.getElementById("downloadBtn").addEventListener("click", ()=>{
  const text = txt.value;
  const format = document.getElementById("downloadFormat").value;

  if(format === "txt"){
    const blob = new Blob([text], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "text.txt";
    a.click();
  }
  else if(format === "pdf"){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const pageWidth = doc.internal.pageSize.getWidth();
    const margin = 10;
    const maxLineWidth = pageWidth - margin*2;
    const lines = doc.splitTextToSize(text, maxLineWidth);
    doc.text(lines, margin, 10);
    doc.save("text.pdf");
  }
  else if(format === "doc"){
    const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' "+
      "xmlns:w='urn:schemas-microsoft-com:office:word' "+
      "xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Document</title></head><body>";
    const footer = "</body></html>";
    const blob = new Blob([header+text+footer], { type: "application/msword" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "text.doc";
    a.click();
  }
  else if(format === "xlsx"){
    const ws = XLSX.utils.aoa_to_sheet(text.split(/\r?\n/).map(line => [line]));
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
    XLSX.writeFile(wb, "text.xlsx");
  }
});

// DARK MODE
darkToggle.addEventListener("change", ()=>{ if(darkToggle.checked) document.body.classList.add("dark"); else document.body.classList.remove("dark"); });

// ----------------------
// Translation system
// ----------------------
let currentLang = localStorage.getItem('utl_lang') || detectInitialLang() || 'en';
langSelectHeader.value = currentLang;

function detectInitialLang(){
  const nav = (navigator.languages && navigator.languages[0]) || navigator.language || navigator.userLanguage || 'en';
  const map = { "en":"en","es":"es","fr":"fr","de":"de","hi":"hi","zh":"zh-CN","zh-CN":"zh-CN","ja":"ja","ru":"ru","ar":"ar","pt":"pt" };
  for(const code of [nav, nav.split('-')[0]]){
    if(map[code]) return map[code];
  }
  return 'en';
}

function applyTranslations(lang){
  currentLang = translations[lang] ? lang : 'en';
  localStorage.setItem('utl_lang', currentLang);

  const t = translations[currentLang];

  // Header & placeholders
  headerTitle.textContent = t.headerTitle;
  txt.placeholder = t.placeholder;

  // Buttons & labels
  clearBtn.textContent = t.clearBtn;
  copyBtn.textContent = t.copyBtn;
  downloadBtn.textContent = t.downloadBtn;
  darkLabelSpan.textContent = t.darkLabel;

  // Case select options (keep values same, only change labels)
  const caseMap = t.caseOptions;
  Array.from(sel.options).forEach(opt => {
    if(caseMap[opt.value]) opt.textContent = caseMap[opt.value];
  });

  // Download format options
  Array.from(downloadFormat.options).forEach(opt => {
    if(t.downloadOptions[opt.value]) opt.textContent = t.downloadOptions[opt.value];
  });

  // Stats labels
  label_chars.childNodes[0] && (label_chars.childNodes[0].nodeValue = t.stats.chars + " ");
  label_words.childNodes[0] && (label_words.childNodes[0].nodeValue = t.stats.words + " ");
  label_sent.childNodes[0] && (label_sent.childNodes[0].nodeValue = t.stats.sent + " ");
  label_para.childNodes[0] && (label_para.childNodes[0].nodeValue = t.stats.para + " ");
  label_space.childNodes[0] && (label_space.childNodes[0].nodeValue = t.stats.space + " ");

  // Duplicates panel
  dupLabelSpan.childNodes[0] && (dupLabelSpan.childNodes[0].nodeValue = t.dupLabel + " ");
  dup_th_word.textContent = t.dupTable.word;
  dup_th_count.textContent = t.dupTable.count;

  // Tooltip text will be set when used
  copyTooltip.textContent = t.copyTooltip;

  // Update duplicate table message
  const hasDups = (txt.value.toLowerCase().match(/\b\w+\b/g)||[]).some((v,i,arr)=> arr.indexOf(v)!==i);
  if(!hasDups){
    noDuplicatesText.textContent = t.dupTable.nodups;
  }

  // Update charBox suffix? keep English 'characters' for numeric clarity, but you can change if desired.
}

// When user selects a language
langSelectHeader.addEventListener("change", (e)=>{
  const val = e.target.value;
  applyTranslations(val);
});

// Apply initial translations on load
applyTranslations(currentLang);

// ----------------------
// Init
// ----------------------
updateStats();

</script>
<!-- Lightweight Browser Translation Notice (Option 1) -->
<style>
#browserTranslateTip {
  position: fixed;
  bottom: 15px;
  right: 15px;
  background: #007bff;
  color: white;
  padding: 10px 15px;
  font-size: 14px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  z-index: 9999;
}
#browserTranslateTip select {
  background: white;
  color: #000;
  border-radius: 5px;
  border: none;
  padding: 3px 6px;
  margin-left: 5px;
}
</style>

<div id="browserTranslateTip">
  üåê Translate Page:
  <select id="browserLangSelect">
    <option value="">Choose language</option>
    <option value="hi">Hindi</option>
    <option value="mr">Marathi</option>
    <option value="bn">Bengali</option>
    <option value="ta">Tamil</option>
    <option value="te">Telugu</option>
    <option value="gu">Gujarati</option>
    <option value="pa">Punjabi</option>
    <option value="kn">Kannada</option>
    <option value="ml">Malayalam</option>
    <option value="ur">Urdu</option>
  </select>
  <div style="font-size:12px;margin-top:3px;">Right-click ‚Üí Translate</div>
</div>

<script>
document.getElementById("browserLangSelect").addEventListener("change", function(){
  if(!this.value) return;

  alert(
    "To translate:\n\n" +
    "1. Right-click anywhere on the page\n" +
    "2. Click 'Translate to " + this.value + "'\n" +
    "\nThis works in Chrome, Edge, Opera, Brave."
  );
});
</script>

</body>
</html>
