<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sentence Case Character Counter</title>
<style>
body { font-family: Arial, sans-serif; background: #f2f4f8; display: flex; justify-content: center; padding: 30px; transition: background 0.3s, color 0.3s; }
body.dark { background: #1a1a1a; color: white; }
.app-container { width: 850px; background: #fff; padding: 0; border-radius: 15px; overflow: hidden; box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
body.dark .app-container { background: #222; }
.header-bar { background: #007bff; padding: 18px 20px 8px; color: #fff; display: flex; align-items: center; justify-content: space-between; }
.header-title { font-size: 28px; font-weight: 900; margin: 0; }
#langSelectHeader { height: 30px; border-radius: 5px; font-size: 14px; padding: 2px 5px; }

/* Toolbar */
.toolbar { background: #007bff; padding: 12px 20px; display: flex; flex-wrap: nowrap; gap: 10px; align-items: center; color: #fff; overflow-x: auto; }
select, button, #charBox { height: 40px; padding: 0 12px; border-radius: 8px; font-weight: bold; font-size: 15px; border: none; }
select { border: 2px solid black; }
button { background: white; cursor: pointer; border: 2px solid #ccc; }
#clearBtn { color: red; }
#charBox { background: #ffeb3b; color: #007bff; text-transform: capitalize; box-shadow: 0 3px 8px rgba(0,0,0,0.2); font-weight: bold; display: flex; align-items: center; }
.toggle-label { display: flex; align-items: center; gap: 5px; font-weight: bold; }

/* Textarea & Highlight */
.textarea-wrapper { position: relative; width: 100%; max-height: 400px; }
#highlightLayer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; padding: 20px; white-space: pre-wrap; word-wrap: break-word; color: transparent; z-index: 1; line-height: 1.5; box-sizing: border-box; }
#textInput { position: relative; width: 100%; height: 300px; padding: 20px; border: none; border-top: 2px solid #ddd; font-size: 17px; line-height: 1.5; resize: vertical; outline: none; background: transparent; color: #000; z-index: 2; box-sizing: border-box; }
body.dark #textInput { color:#fff; border-color:#444; }

/* Stats */
.stats-bar { background: #007bff; padding: 15px; display: flex; justify-content: space-around; color: #fff; font-size: 16px; font-weight: bold; }

/* Duplicates panel */
.duplicates-panel { background: #e3f2fd; padding: 10px 15px; border-top: 2px solid #007bff; font-size: 14px; color: #000; }
body.dark .duplicates-panel { background: #333; color: #fff; }
.duplicates-panel b { color: red; }
.dup-table-wrapper { max-height: 150px; overflow-y: auto; margin-top: 5px; }
.dup-table-wrapper table { width: 100%; border-collapse: collapse; font-size: 13px; }
.dup-table-wrapper th, .dup-table-wrapper td { border: 1px solid #007bff; padding: 5px; text-align: left; }
.dup-table-wrapper th { background: #007bff; color: white; position: sticky; top: 0; z-index: 2; }
body.dark .dup-table-wrapper th { background: #555; color: #fff; }

@media (max-width: 600px) {
  .toolbar { flex-wrap: wrap; }
  select, button, #charBox { width: 100%; justify-content: center; }
}
.copy-tooltip {
  visibility: hidden;
  background-color: #4caf50;
  color: white;
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 13px;
  position: absolute;
  opacity: 0;
  transition: opacity 0.3s;
  pointer-events: none;
  z-index: 1000;
}
.copy-tooltip.show {
  visibility: visible;
  opacity: 1;
}

</style>
</head>
<body>
<div class="app-container">

<div class="header-bar">
  <div class="header-title">Sentence Case Character Counter</div>
 
</div>

<div class="toolbar">
  <select id="caseSelect">
    <option value="sentence">Sentence case</option>
    <option value="lower">lowercase</option>
    <option value="upper">UPPERCASE</option>
    <option value="capital">Capitalize Each Word</option>
    <option value="toggle">tOGGLE cASE</option>
  </select>

  <button id="clearBtn">Clear</button>
  <div id="charBox">0 characters</div>

  <button id="copyBtn">Copy</button>
<span id="copyTooltip" class="copy-tooltip">Copied!</span>

  <select id="downloadFormat">
    <option value="txt">Text (.txt)</option>
    <option value="pdf">PDF (.pdf)</option>
    <option value="doc">Word (.docx)</option>
    <option value="xlsx">Excel (.xlsx)</option>
  </select>
  <button id="downloadBtn">Download</button>

  <label class="toggle-label">
    <input type="checkbox" id="darkToggle"> Dark
  </label>
</div>

<div class="textarea-wrapper">
  <div id="highlightLayer"></div>
  <textarea id="textInput" placeholder="Type your text here..."></textarea>
</div>

<div class="stats-bar">
  <span>CHARS <b id="s_chars">0</b></span>
  <span>WORDS <b id="s_words">0</b></span>
  <span>SENTENCES <b id="s_sent">0</b></span>
  <span>PARA <b id="s_para">0</b></span>
  <span>SPACES <b id="s_space">0</b></span>
</div>

<div class="duplicates-panel">
  <span>Duplicate Words Count: <b id="dup_count">0</b></span>
  <div class="dup-table-wrapper">
    <table id="dup_table">
      <thead>
        <tr><th>Word</th><th>Count</th></tr>
      </thead>
      <tbody><tr><td colspan="2">No duplicates</td></tr></tbody>
    </table>
  </div>
</div>

<div id="google_translate_element" style="display:none;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
// Elements
const txt=document.getElementById("textInput");
const sel=document.getElementById("caseSelect");
const charBox=document.getElementById("charBox");
const darkToggle=document.getElementById("darkToggle");
const s_chars=document.getElementById("s_chars");
const s_words=document.getElementById("s_words");
const s_sent=document.getElementById("s_sent");
const s_para=document.getElementById("s_para");
const s_space=document.getElementById("s_space");
const dup_count=document.getElementById("dup_count");
const dup_table=document.getElementById("dup_table").querySelector("tbody");
const highlightLayer=document.getElementById("highlightLayer");
const langSelectHeader=document.getElementById("langSelectHeader");

let composing=false;

// CASE FUNCTIONS
function sentenceCase(t){ t=t.toLowerCase(); return t.replace(/(^\s*[a-z])|([.!?]\s*[a-z])/g,m=>m.toUpperCase()); }
function lower(t){ return t.toLowerCase(); }
function upper(t){ return t.toUpperCase(); }
function capital(t){ return t.replace(/\b(\w)(\w*)/g,(_,a,b)=>a.toUpperCase()+b.toLowerCase()); }
function toggle(t){ return t.split("").map(c=>c===c.toUpperCase()?c.toLowerCase():c.toUpperCase()).join(""); }
function applyCase(text){ switch(sel.value){ case"sentence":return sentenceCase(text); case"lower":return lower(text); case"upper":return upper(text); case"capital":return capital(text); case"toggle":return toggle(text);} return text; }

// STATS & DUPLICATES
function updateStats(){ const t=txt.value;
  s_chars.textContent=t.length;
  s_words.textContent=t.trim()? t.trim().split(/\s+/).length:0;
  s_sent.textContent=t.split(/[.!?]+/).filter(Boolean).length;
  s_para.textContent=t.split(/\n+/).filter(Boolean).length;
  s_space.textContent=(t.match(/ /g)||[]).length;
  charBox.textContent=t.length+" characters";
  updateDuplicates(t);
}

function highlightDuplicates(text){
  const words=text.toLowerCase().match(/\b\w+\b/g)||[];
  const counts={}; words.forEach(w=>counts[w]=(counts[w]||0)+1);
  let highlighted = text.replace(/\b\w+\b/g, word=>{
    return counts[word.toLowerCase()]>1 ? `<mark style="background:yellow;color:black;">${word}</mark>` : word;
  });
  highlighted = highlighted.replace(/\n/g,'<br>').replace(/ /g,'&nbsp;');
  highlightLayer.innerHTML = highlighted;
}

function updateDuplicates(text){
  const words=text.toLowerCase().match(/\b\w+\b/g)||[];
  const counts={}; words.forEach(w=>counts[w]=(counts[w]||0)+1);
  const duplicates=Object.keys(counts).filter(k=>counts[k]>1);
  dup_count.textContent=duplicates.length;
  dup_table.innerHTML="";
  if(duplicates.length){
    duplicates.forEach(w=>{
      const tr=document.createElement("tr");
      const tdW=document.createElement("td"); tdW.textContent=w;
      const tdC=document.createElement("td"); tdC.textContent=counts[w];
      tr.appendChild(tdW); tr.appendChild(tdC);
      dup_table.appendChild(tr);
    });
  } else{
    const tr=document.createElement("tr");
    const td=document.createElement("td"); td.colSpan=2; td.textContent="No duplicates";
    tr.appendChild(td); dup_table.appendChild(tr);
  }
  highlightDuplicates(text);
}

// EVENTS
sel.addEventListener("change",()=>{ const s=txt.selectionStart,e=txt.selectionEnd; txt.value=applyCase(txt.value); txt.setSelectionRange(s,e); updateStats(); });
txt.addEventListener("input",()=>{ const s=txt.selectionStart,e=txt.selectionEnd; if(sel.value==="sentence"){ const updated=applyCase(txt.value); if(updated!==txt.value){ txt.value=updated; txt.setSelectionRange(s,e); } } updateStats(); });
txt.addEventListener("compositionstart",()=>composing=true);
txt.addEventListener("compositionend",()=>composing=false);
document.getElementById("clearBtn").addEventListener("click",()=>{ txt.value=""; updateStats(); });

// COPY
const copyBtn = document.getElementById("copyBtn");
const tooltip = document.getElementById("copyTooltip");

copyBtn.addEventListener("click", () => {
  const textToCopy = txt.value; // txt is your textarea element
  navigator.clipboard.writeText(textToCopy).then(() => {
    // Position tooltip above the button
    const rect = copyBtn.getBoundingClientRect();
    tooltip.style.top = rect.top - 35 + window.scrollY + "px";
    tooltip.style.left = rect.left + window.scrollX + "px";
    tooltip.classList.add("show");

    // Hide after 2 seconds
    setTimeout(() => {
      tooltip.classList.remove("show");
    }, 2000);
  }).catch(() => {
    // fallback copy
    const temp = document.createElement("textarea");
    temp.value = textToCopy;
    document.body.appendChild(temp);
    temp.select();
    document.execCommand("copy");
    document.body.removeChild(temp);

    tooltip.style.top = copyBtn.getBoundingClientRect().top - 35 + window.scrollY + "px";
    tooltip.style.left = copyBtn.getBoundingClientRect().left + window.scrollX + "px";
    tooltip.classList.add("show");
    setTimeout(() => tooltip.classList.remove("show"), 2000);
  });
});


// DOWNLOAD
document.getElementById("downloadBtn").addEventListener("click",()=>{
  const text = txt.value;
  const format = document.getElementById("downloadFormat").value;

  if(format === "txt"){
    const blob = new Blob([text], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "text.txt";
    a.click();
  }
  else if(format === "pdf"){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const pageWidth = doc.internal.pageSize.getWidth();
    const margin = 10;
    const maxLineWidth = pageWidth - margin*2;
    const lines = doc.splitTextToSize(text, maxLineWidth);
    doc.text(lines, margin, 10);
    doc.save("text.pdf");
  }
  else if(format === "doc"){
    const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' "+
      "xmlns:w='urn:schemas-microsoft-com:office:word' "+
      "xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Document</title></head><body>";
    const footer = "</body></html>";
    const blob = new Blob([header+text+footer], { type: "application/msword" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "text.doc";
    a.click();
  }
  else if(format === "xlsx"){
    const ws = XLSX.utils.aoa_to_sheet(text.split(/\r?\n/).map(line => [line]));
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
    XLSX.writeFile(wb, "text.xlsx");
  }
});

// DARK MODE
darkToggle.addEventListener("change",()=>{ if(darkToggle.checked) document.body.classList.add("dark"); else document.body.classList.remove("dark"); });

// GOOGLE TRANSLATE
function googleTranslateElementInit(){ new google.translate.TranslateElement({ pageLanguage:'en', includedLanguages:'en,es,fr,de,hi,zh-CN,ja,ru,ar,pt', layout:google.translate.TranslateElement.InlineLayout.SIMPLE, autoDisplay:false },'google_translate_element'); }
langSelectHeader.addEventListener("change",function(){ const lang=this.value; const select=document.querySelector("select.goog-te-combo"); if(select){ select.value=lang; select.dispatchEvent(new Event('change')); } });
var gtScript=document.createElement('script'); gtScript.type='text/javascript'; gtScript.src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"; document.head.appendChild(gtScript);

</script>
</body>
</html>
