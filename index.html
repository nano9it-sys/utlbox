<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ToolBox All-in-One</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');

/* THEME COLORS */
:root{
    --bg:#0f2027;
    --card:#24343c;
    --text:#ffffff;
    --accent:#4fc3ff;
    --border:#2f4a54;
}
.light{
    --bg:#f4f6f8;
    --card:#ffffff;
    --text:#000000;
    --accent:#1a73e8;
    --border:#dcdcdc;
}

/* GENERAL STYLES */
*{box-sizing:border-box;}
body{
    margin:0;
    font-family:Poppins,sans-serif;
    background:var(--bg);
    color:var(--text);
    padding-top:60px; /* leave space for fixed nav */
    transition: background 0.3s, color 0.3s;
}
a{cursor:pointer;}

/* NAVIGATION */
.top-nav{
    position:fixed; top:0; left:0; right:0;
    background:var(--card);
    display:flex; align-items:center;
    padding:12px 20px;
    gap:15px;
    z-index:1000;
    flex-wrap:wrap;
}
.top-nav .logo{ font-weight:600; font-size:20px; }
.top-nav .menu a{
    text-decoration:none; padding:6px 12px; border-radius:6px;
    color:var(--text); font-weight:500;
}
.top-nav .menu a.active, .top-nav .menu a:hover{
    background:var(--accent); color:#000;
}
.top-nav button{
    margin-left:auto; padding:6px 12px; border:none; border-radius:6px; cursor:pointer; background:var(--accent); color:#000; font-weight:500;
}

/* PAGE STYLE */
.page{ display:none; padding:30px; max-width:1200px; margin:auto; }
.page.active{ display:block; }

/* CARD STYLE FOR CHAR COUNTER & GST */
.app-container{
    background:var(--card);
    padding:20px;
    border-radius:14px;
    box-shadow:0 6px 18px rgba(0,0,0,.25);
    margin-bottom:20px;
    transition: background 0.3s, color 0.3s;
}

/* TOOLBAR */
.toolbar{ display:flex; flex-wrap:wrap; gap:10px; margin-bottom:10px; }
.toolbar select, .toolbar button{ padding:8px 12px; border-radius:6px; border:none; font-size:14px; cursor:pointer; }
#textInput{ width:100%; height:250px; padding:12px; border-radius:8px; border:none; resize:vertical; font-size:15px; background:rgba(255,255,255,0.1); color:var(--text); }

/* STATS & DUPLICATES */
.stats-bar{ display:flex; justify-content:space-around; padding:10px; font-weight:500; margin-top:10px; flex-wrap:wrap; }
.duplicates-panel{ margin-top:12px; font-size:13px; }
.dup-table-wrapper table{ width:100%; border-collapse:collapse; font-size:13px; }
.dup-table-wrapper th, .dup-table-wrapper td{ border:1px solid var(--border); padding:5px; text-align:left; }
.dup-table-wrapper th{ background:var(--accent); color:#000; }
.dup-table-wrapper td{ background:var(--card); color:var(--text); }

/* GST BOX */
.gst-box input, .gst-box select, .gst-box button{
    width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:none; font-size:14px; cursor:pointer;
}

/* COPY TOOLTIP */
.copy-tooltip{
    visibility:hidden; background-color:#4caf50; color:white; padding:5px 10px; border-radius:5px; font-size:13px;
    position:absolute; opacity:0; transition:opacity 0.3s; pointer-events:none; z-index:1000;
}
.copy-tooltip.show{ visibility:visible; opacity:1; }

/* === LOCAL FILE SEARCH STYLES (UNCHANGED) === */
#controls{
    position:relative;
    background:linear-gradient(180deg,rgba(0,0,0,.05),transparent);
    backdrop-filter:blur(12px);
    padding:14px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:center;
    margin-bottom:20px;
}
#controls::after{
    content:"";
    position:absolute;
    left:0;right:0;bottom:0;
    height:3px;
    background:linear-gradient(90deg,transparent,var(--accent),transparent);
    animation:dividerMove 3s linear infinite;
}
@keyframes dividerMove{
    0%{background-position:0%}
    100%{background-position:200%}
}
input,select,button{
    padding:9px 12px;
    border-radius:8px;
    border:none;
    font-family:inherit;
}
input,select{
    background:rgba(255,255,255,.18);
    color:var(--text);
}
select{ appearance:none; }
select option{ background:#24343c; color:#fff; }
body.light select, body.light select option{ background:#fff; color:#000; }
button{ background:var(--accent); color:#fff; cursor:pointer; }
.toggle{background:#ff9800}
h1{text-align:center;margin:14px 0 4px;letter-spacing:1.5px;font-weight:600;position:relative;animation:fadeUp .9s ease forwards;opacity:0;}
h1::before{content:"";position:absolute;left:50%;transform:translateX(-50%);bottom:-8px;width:60%;height:18px;background:radial-gradient(circle,var(--accent),transparent 70%);filter:blur(12px);opacity:.6;}
h1::after{content:"";display:block;margin:10px auto 0;width:160px;height:4px;border-radius:4px;background:linear-gradient(90deg,transparent,var(--accent),transparent);}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
#folderPath,#fileCount{text-align:center;font-size:13px;opacity:.85;}
#results{max-width:1150px;margin:24px auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:16px;}
.result-card{background:var(--card);padding:14px;border-radius:14px;cursor:pointer;border:1px solid var(--border);transition:all .25s ease;}
body.light .result-card{box-shadow:0 6px 18px rgba(0,0,0,.08);}
.result-card:hover{transform:translateY(-3px);box-shadow:0 10px 26px rgba(0,0,0,.25);}
.file-row{display:flex;gap:12px;}
.icon{font-size:26px}
small{font-size:12px;opacity:.8}
.action-row{display:flex;justify-content:space-between;align-items:center;margin-top:10px;font-size:12px;}
.download-btn{background:#34a853;padding:6px 10px;font-size:12px;border-radius:6px;}
.highlight{background:#ffe066;color:#000;padding:0 4px;border-radius:4px;}
#chartWrap{max-width:1150px;margin:30px auto;background:var(--card);padding:14px;border-radius:14px;}
</style>
</head>
<body class="light">

<nav class="top-nav">
  <div class="logo">ToolBox</div>
  <div class="menu">
    <a onclick="switchPage('char-counter', this)" class="active">Character Counter</a>
    <a onclick="switchPage('gst-calculator', this)">GST Calculator</a>
    <a onclick="switchPage('file-search', this)">Local File Search</a>
  </div>
  <button onclick="toggleTheme()">Dark / Light</button>
</nav>

<!-- Character Counter -->
<section id="char-counter" class="page active">
<div class="app-container">
<h2>Character Counter</h2>
<div class="toolbar">
  <select id="caseSelect">
    <option value="sentence">Sentence case</option>
    <option value="lower">lowercase</option>
    <option value="upper">UPPERCASE</option>
    <option value="capital">Capitalize Each Word</option>
    <option value="toggle">tOGGLE cASE</option>
  </select>
  <button id="clearBtn">Clear</button>
  <button onclick="undoText()">â†¶ Undo</button>
  <button onclick="redoText()">â†· Redo</button>
  <button id="copyBtn">Copy</button>
  <select id="downloadFormat">
    <option value="txt">Text (.txt)</option>
    <option value="pdf">PDF (.pdf)</option>
    <option value="doc">Word (.docx)</option>
    <option value="xlsx">Excel (.xlsx)</option>
  </select>
  <button id="downloadBtn">Download</button>
  <span id="copyTooltip" class="copy-tooltip">Copied!</span>
</div>
<textarea id="textInput" placeholder="Type your text here..."></textarea>
<div class="stats-bar">
  <span>Chars: <b id="s_chars">0</b></span>
  <span>Words: <b id="s_words">0</b></span>
  <span>Sentences: <b id="s_sent">0</b></span>
  <span>Paragraphs: <b id="s_para">0</b></span>
  <span>Spaces: <b id="s_space">0</b></span>
</div>
<div class="duplicates-panel">
  <span>Duplicate Words: <b id="dup_count">0</b></span>
  <div class="dup-table-wrapper">
    <table id="dup_table"><thead><tr><th>Word</th><th>Count</th></tr></thead><tbody><tr><td colspan="2">No duplicates</td></tr></tbody></table>
  </div>
</div>
</div>
</section>

<!-- GST Calculator -->
<section id="gst-calculator" class="page">
<div class="app-container gst-box">
<h2>GST Calculator</h2>
<input id="total" type="number" placeholder="Total Amount (GST Included)">
<select id="percent">
  <option value="5">5%</option>
  <option value="12">12%</option>
  <option value="18">18%</option>
  <option value="28">28%</option>
</select>
<select id="type">
  <option value="sc">SGST + CGST</option>
  <option value="ig">IGST</option>
</select>
<button onclick="gst()">Calculate</button>
<div id="result"></div>
</div>
</section>

<!-- Local File Search -->
<section id="file-search" class="page">
<h1>Advanced Local File Search</h1>
<div id="folderPath">No folder selected</div>
<div id="fileCount"></div>
<div id="controls">
  <input type="file" id="folderInput" webkitdirectory multiple>
  <input type="text" id="searchBox" placeholder="Search files..." disabled>
  <select id="fileType" disabled>
    <option value="">All types</option>
    <option value=".txt">TXT</option>
    <option value=".pdf">PDF</option>
    <option value=".js">JS</option>
    <option value=".html">HTML</option>
    <option value=".css">CSS</option>
    <option value=".xlsx">XLSX</option>
    <option value=".docs">DOCS</option>
    <option value=".exe">EXE</option>
    <option value=".jpg">JPG</option>
    <option value=".png">PNG</option>
    <option value=".jpeg">JPEG</option>
    <option value=".webp">WEBP</option>
    <option value=".gif">GIF</option>
  </select>
  <select id="sortBy" disabled>
    <option value="date">Date</option>
    <option value="name">Name</option>
    <option value="size">Size</option>
  </select>
  <select id="sortOrder" disabled>
    <option value="desc">Desc</option>
    <option value="asc">Asc</option>
  </select>
  <button onclick="updateResults()">Search</button>
</div>
<div id="results"></div>
<div id="chartWrap"><canvas id="sizeChart" height="160"></canvas></div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
/* === PAGE SWITCHING === */
function switchPage(id, el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.menu a').forEach(a=>a.classList.remove('active'));
  el.classList.add('active');
}

/* === DARK/LIGHT THEME === */
function toggleTheme(){ document.body.classList.toggle('light'); localStorage.setItem('theme', document.body.className);}
document.body.className = localStorage.getItem('theme') || "light";

/* === CHARACTER COUNTER FUNCTIONS === */
let undoStack=[], redoStack=[];
const txt=document.getElementById("textInput");
const sel=document.getElementById("caseSelect");
const charBox=document.getElementById("s_chars");
const s_words=document.getElementById("s_words");
const s_sent=document.getElementById("s_sent");
const s_para=document.getElementById("s_para");
const s_space=document.getElementById("s_space");
const dup_count=document.getElementById("dup_count");
const dup_table=document.getElementById("dup_table").querySelector("tbody");

function saveState(){ undoStack.push(txt.value); if(undoStack.length>100) undoStack.shift(); }
function undoText(){ if(!undoStack.length) return; redoStack.push(txt.value); txt.value=undoStack.pop(); updateStats(); }
function redoText(){ if(!redoStack.length) return; undoStack.push(txt.value); txt.value=redoStack.pop(); updateStats(); }
txt.addEventListener("input",()=>{ saveState(); updateStats(); });

function sentenceCase(t){ t=t.toLowerCase(); return t.replace(/(^\s*[a-z])|([.!?]\s*[a-z])/g,m=>m.toUpperCase()); }
function lower(t){ return t.toLowerCase(); }
function upper(t){ return t.toUpperCase(); }
function capital(t){ return t.replace(/\b(\w)(\w*)/g,(_,a,b)=>a.toUpperCase()+b.toLowerCase()); }
function toggleCase(t){ return t.split("").map(c=>c===c.toUpperCase()?c.toLowerCase():c.toUpperCase()).join(""); }
function applyCase(text){ switch(sel.value){ case"sentence":return sentenceCase(text); case"lower":return lower(text); case"upper":return upper(text); case"capital":return capital(text); case"toggle":return toggleCase(text);} return text; }

function updateStats(){
  const t=txt.value;
  s_chars.textContent=t.length;
  s_words.textContent=t.trim()? t.trim().split(/\s+/).length:0;
  s_sent.textContent=t.split(/[.!?]+/).filter(Boolean).length;
  s_para.textContent=t.split(/\n+/).filter(Boolean).length;
  s_space.textContent=(t.match(/ /g)||[]).length;
  updateDuplicates(t);
}

function updateDuplicates(text){
  const words=text.toLowerCase().match(/\b\w+\b/g)||[];
  const counts={}; words.forEach(w=>counts[w]=(counts[w]||0)+1);
  const duplicates=Object.keys(counts).filter(k=>counts[k]>1);
  dup_count.textContent=duplicates.length;
  dup_table.innerHTML="";
  if(duplicates.length){ duplicates.forEach(w=>{ const tr=document.createElement("tr"); tr.innerHTML=`<td>${w}</td><td>${counts[w]}</td>`; dup_table.appendChild(tr); }); }
  else{ dup_table.innerHTML=`<tr><td colspan="2">No duplicates</td></tr>`; }
}

/* COPY & DOWNLOAD */
document.getElementById("copyBtn").addEventListener("click",()=>{
    navigator.clipboard.writeText(txt.value).then(()=>{
        const tooltip=document.getElementById("copyTooltip");
        tooltip.classList.add("show");
        setTimeout(()=>tooltip.classList.remove("show"),2000);
    });
});
document.getElementById("downloadBtn").addEventListener("click",()=>{
    const text=txt.value;
    const format=document.getElementById("downloadFormat").value;
    if(format==="txt"){ const blob=new Blob([text],{type:"text/plain"}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="text.txt"; a.click();}
    else if(format==="pdf"){ const { jsPDF }=window.jspdf; const doc=new jsPDF(); const lines=doc.splitTextToSize(text,180); doc.text(lines,10,10); doc.save("text.pdf");}
    else if(format==="doc"){ const blob=new Blob([text],{type:"application/msword"}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="text.doc"; a.click();}
    else if(format==="xlsx"){ const ws=XLSX.utils.aoa_to_sheet(text.split(/\n/).map(l=>[l])); const wb=XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,"Sheet1"); XLSX.writeFile(wb,"text.xlsx");}
});
sel.addEventListener("change",()=>{ txt.value=applyCase(txt.value); updateStats(); });

/* GST CALCULATOR */
function gst(){
    let T=+document.getElementById("total").value;
    let P=+document.getElementById("percent").value;
    let type=document.getElementById("type").value;
    if(!T) return;
    let base=T/(1+P/100), tax=T-base;
    document.getElementById("result").innerHTML=
        `Base: â‚¹${base.toFixed(2)}<br>`+
        (type==="sc"?`SGST: â‚¹${(tax/2).toFixed(2)}<br>CGST: â‚¹${(tax/2).toFixed(2)}`:`IGST: â‚¹${tax.toFixed(2)}`)+
        `<br><b>Total: â‚¹${T.toFixed(2)}</b>`;
}

/* === LOCAL FILE SEARCH FUNCTIONS === */
let filesData=[];
const folderInput2=document.getElementById("folderInput");
const searchBox2=document.getElementById("searchBox");
const fileType2=document.getElementById("fileType");
const sortBy2=document.getElementById("sortBy");
const sortOrder2=document.getElementById("sortOrder");
const folderPath2=document.getElementById("folderPath");
const fileCount2=document.getElementById("fileCount");
const results2=document.getElementById("results");
const sizeChart2=document.getElementById("sizeChart");

const esc=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");
const highlight2=(t,k)=>k?t.replace(new RegExp(`(${esc(k)})`,"gi"),`<span class="highlight">$1</span>`):t;
const sizeFmt=b=>b>1048576?(b/1048576).toFixed(1)+" MB":(b/1024).toFixed(1)+" KB";
const icon=n=>/pdf/i.test(n)?"ðŸ“•":/jpg|png|jpeg|gif/i.test(n)?"ðŸ–¼ï¸":/exe/i.test(n)?"âš™ï¸":"ðŸ“„";

folderInput2.onchange=e=>{
    filesData=[];
    const f=e.target.files;
    if(!f.length) return;
    folderPath2.innerText="Selected Folder: "+f[0].webkitRelativePath.split("/")[0];
    for(let x of f){ filesData.push({file:x,name:x.name,path:x.webkitRelativePath,size:x.size,lastModified:x.lastModified}); }
    searchBox2.disabled=fileType2.disabled=sortBy2.disabled=sortOrder2.disabled=false;
};
searchBox2.oninput=updateResults;

function updateResults(){
    const key=searchBox2.value.toLowerCase();
    let list=[...filesData];
    if(key) list=list.filter(f=>f.name.toLowerCase().includes(key)||f.path.toLowerCase().includes(key));
    if(fileType2.value) list=list.filter(f=>f.name.endsWith(fileType2.value));
    list.sort((a,b)=>{
        let v=sortBy2.value==="name"?a.name.localeCompare(b.name):
              sortBy2.value==="size"?a.size-b.size:
              a.lastModified-b.lastModified;
        return sortOrder2.value==="asc"?v:-v;
    });
    fileCount2.innerText="Total Files: "+list.length;
    results2.innerHTML="";
    list.forEach(f=>{
        const card=document.createElement("div");
        card.className="result-card";
        card.ondblclick=()=>window.open(URL.createObjectURL(f.file));
        card.innerHTML=`
        <div class="file-row">
            <div class="icon">${icon(f.name)}</div>
            <div><strong>${highlight2(f.name,key)}</strong><br><small>${highlight2(f.path,key)}</small></div>
        </div>
        <div class="action-row">
            <span>${sizeFmt(f.size)}</span>
            <span>${new Date(f.lastModified).toLocaleString()}</span>
            <button class="download-btn">Download</button>
        </div>`;
        card.querySelector(".download-btn").onclick=e=>{ e.stopPropagation(); const a=document.createElement("a"); a.href=URL.createObjectURL(f.file); a.download=f.name; a.click();};
        results2.appendChild(card);
    });
    drawChart(list);
}
function drawChart(list){
    const c=sizeChart2,ctx=c.getContext("2d");
    ctx.clearRect(0,0,c.width,c.height);
    if(!list.length)return;
    const max=Math.max(...list.map(f=>f.size));
    const w=c.width/list.length;
    list.forEach((f,i)=>{ const h=(f.size/max)*(c.height-20); ctx.fillStyle="#4fc3ff"; ctx.fillRect(i*w,c.height-h,w-3,h); });
}
</script>
</body>
</html>
