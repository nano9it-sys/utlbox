<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sentence Case Character Counter</title>
<style>
body { font-family: Arial, sans-serif; background: #f2f4f8; display: flex; justify-content: center; padding: 30px; transition: background 0.3s, color 0.3s; }
body.dark { background: #1a1a1a; color: white; }
.app-container { width: 850px; background: #fff; padding: 0; border-radius: 15px; overflow: hidden; box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
body.dark .app-container { background: #222; }
.header-bar { background: #007bff; padding: 18px 20px 8px; color: #fff; display: flex; align-items: center; justify-content: space-between; }
.header-title { font-size: 28px; font-weight: 900; margin: 0; }
#langSelectHeader { height: 30px; border-radius: 5px; font-size: 14px; padding: 2px 5px; }

/* Toolbar */
.toolbar { background: #007bff; padding: 12px 20px; display: flex; flex-wrap: nowrap; gap: 10px; align-items: center; color: #fff; overflow-x: auto; }
select, button, #charBox { height: 40px; padding: 0 12px; border-radius: 8px; font-weight: bold; font-size: 15px; border: none; }
select { border: 2px solid black; }
button { background: white; cursor: pointer; border: 2px solid #ccc; }
#clearBtn { color: red; }
#charBox { background: #ffeb3b; color: #007bff; text-transform: capitalize; box-shadow: 0 3px 8px rgba(0,0,0,0.2); font-weight: bold; display: flex; align-items: center; }
.toggle-label { display: flex; align-items: center; gap: 5px; font-weight: bold; }

/* Textarea & Highlight */
.textarea-wrapper { position: relative; width: 100%; max-height: 400px; }
#highlightLayer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; padding: 20px; white-space: pre-wrap; word-wrap: break-word; color: transparent; z-index: 1; line-height: 1.5; box-sizing: border-box; font-size:17px; font-family:inherit; }
#textInput { position: relative; width: 100%; height: 300px; padding: 20px; border: none; border-top: 2px solid #ddd; font-size: 17px; line-height: 1.5; resize: vertical; outline: none; background: transparent; color: #000; z-index: 2; box-sizing: border-box; }
body.dark #textInput { color:#fff; border-color:#444; }

/* Stats */
.stats-bar { background: #007bff; padding: 15px; display: flex; justify-content: space-around; color: #fff; font-size: 16px; font-weight: bold; }

/* Duplicates panel */
.duplicates-panel { background: #e3f2fd; padding: 10px 15px; border-top: 2px solid #007bff; font-size: 14px; color: #000; }
body.dark .duplicates-panel { background: #333; color: #fff; }
.duplicates-panel b { color: red; }
.dup-table-wrapper { max-height: 150px; overflow-y: auto; margin-top: 5px; }
.dup-table-wrapper table { width: 100%; border-collapse: collapse; font-size: 13px; }
.dup-table-wrapper th, .dup-table-wrapper td { border: 1px solid #007bff; padding: 5px; text-align: left; }
.dup-table-wrapper th { background: #007bff; color: white; position: sticky; top: 0; z-index: 2; }
body.dark .dup-table-wrapper th { background: #555; color: #fff; }

@media (max-width: 600px) {
  .toolbar { flex-wrap: wrap; }
  select, button, #charBox { width: 100%; justify-content: center; }
}
.copy-tooltip {
  visibility: hidden;
  background-color: #4caf50;
  color: white;
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 13px;
  position: absolute;
  opacity: 0;
  transition: opacity 0.3s;
  pointer-events: none;
  z-index: 1000;
}
.copy-tooltip.show {
  visibility: visible;
  opacity: 1;
}

/* Hide Google Translate widget */
#google_translate_element { position:absolute; left:-9999px; top:0; }
</style>
</head>
<body>
<div class="app-container">

<div class="header-bar">
  <div class="header-title" id="headerTitle">Sentence Case Character Counter</div>
  <select id="langSelectHeader" aria-label="Language selector">
    <option value="en">English</option>
    <option value="es">Spanish</option>
    <option value="fr">French</option>
    <option value="de">German</option>
    <option value="hi">Hindi</option>
    <option value="zh-CN">Chinese</option>
    <option value="ja">Japanese</option>
    <option value="ru">Russian</option>
    <option value="ar">Arabic</option>
    <option value="pt">Portuguese</option>
  </select>
</div>

<div class="toolbar">
  <select id="caseSelect" aria-label="Case transform">
    <option value="sentence">Sentence case</option>
    <option value="lower">lowercase</option>
    <option value="upper">UPPERCASE</option>
    <option value="capital">Capitalize Each Word</option>
    <option value="toggle">tOGGLE cASE</option>
  </select>

  <button id="clearBtn">Clear</button>
  <div id="charBox">0 characters</div>

  <button id="copyBtn">Copy</button>
  <span id="copyTooltip" class="copy-tooltip">Copied!</span>

  <select id="downloadFormat" aria-label="Download format">
    <option value="txt">Text (.txt)</option>
    <option value="pdf">PDF (.pdf)</option>
    <option value="doc">Word (.docx)</option>
    <option value="xlsx">Excel (.xlsx)</option>
  </select>
  <button id="downloadBtn">Download</button>

  <label class="toggle-label">
    <input type="checkbox" id="darkToggle"> <span id="darkLabel">Dark</span>
  </label>
</div>

<div class="textarea-wrapper">
  <div id="highlightLayer"></div>
  <textarea id="textInput" placeholder="Type your text here..."></textarea>
</div>

<div class="stats-bar" id="statsBar">
  <span id="label_chars">CHARS <b id="s_chars">0</b></span>
  <span id="label_words">WORDS <b id="s_words">0</b></span>
  <span id="label_sent">SENTENCES <b id="s_sent">0</b></span>
  <span id="label_para">PARA <b id="s_para">0</b></span>
  <span id="label_space">SPACES <b id="s_space">0</b></span>
</div>

<div class="duplicates-panel">
  <span id="dupLabel">Duplicate Words Count: <b id="dup_count">0</b></span>
  <div class="dup-table-wrapper">
    <table id="dup_table">
      <thead>
        <tr><th id="dup_th_word">Word</th><th id="dup_th_count">Count</th></tr>
      </thead>
      <tbody><tr><td colspan="2" id="noDuplicatesText">No duplicates</td></tr></tbody>
    </table>
  </div>
</div>

<!-- Google Translate hidden container -->
<div id="google_translate_element"></div>

<!-- libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
// ----------------------
// Local translations
// ----------------------
const translations = {
  "en": { headerTitle:"Sentence Case Character Counter", placeholder:"Type your text here...", clearBtn:"Clear", copyBtn:"Copy", copyTooltip:"Copied!", downloadBtn:"Download", darkLabel:"Dark", caseOptions:{sentence:"Sentence case",lower:"lowercase",upper:"UPPERCASE",capital:"Capitalize Each Word",toggle:"tOGGLE cASE"}, downloadOptions:{txt:"Text (.txt)",pdf:"PDF (.pdf)",doc:"Word (.docx)",xlsx:"Excel (.xlsx)"}, stats:{chars:"CHARS",words:"WORDS",sent:"SENTENCES",para:"PARA",space:"SPACES"}, dupLabel:"Duplicate Words Count:", dupTable:{word:"Word",count:"Count",nodups:"No duplicates"}},
  "es": { headerTitle:"Contador de Caracteres (Mayúsculas de Oración)", placeholder:"Escribe tu texto aquí...", clearBtn:"Limpiar", copyBtn:"Copiar", copyTooltip:"¡Copiado!", downloadBtn:"Descargar", darkLabel:"Oscuro", caseOptions:{sentence:"Oración",lower:"minúsculas",upper:"MAYÚSCULAS",capital:"Capitalizar Cada Palabra",toggle:"cAMBIO dE mAYÚSCULAS"}, downloadOptions:{txt:"Texto (.txt)",pdf:"PDF (.pdf)",doc:"Word (.docx)",xlsx:"Excel (.xlsx)"}, stats:{chars:"CAR",words:"PALABRAS",sent:"ORACIONES",para:"PÁRRAFOS",space:"ESPACIOS"}, dupLabel:"Cantidad de Palabras Duplicadas:", dupTable:{word:"Palabra",count:"Cuenta",nodups:"Sin duplicados"}}
};

// ----------------------
// Elements
// ----------------------
const txt = document.getElementById("textInput");
const sel = document.getElementById("caseSelect");
const charBox = document.getElementById("charBox");
const darkToggle = document.getElementById("darkToggle");
const s_chars = document.getElementById("s_chars");
const s_words = document.getElementById("s_words");
const s_sent = document.getElementById("s_sent");
const s_para = document.getElementById("s_para");
const s_space = document.getElementById("s_space");
const dup_count = document.getElementById("dup_count");
const dup_table = document.getElementById("dup_table").querySelector("tbody");
const highlightLayer = document.getElementById("highlightLayer");
const langSelectHeader = document.getElementById("langSelectHeader");
const headerTitle = document.getElementById("headerTitle");
const clearBtn = document.getElementById("clearBtn");
const copyBtn = document.getElementById("copyBtn");
const downloadBtn = document.getElementById("downloadBtn");
const downloadFormat = document.getElementById("downloadFormat");
const darkLabelSpan = document.getElementById("darkLabel");
const copyTooltip = document.getElementById("copyTooltip");
const label_chars = document.getElementById("label_chars");
const label_words = document.getElementById("label_words");
const label_sent = document.getElementById("label_sent");
const label_para = document.getElementById("label_para");
const label_space = document.getElementById("label_space");
const dupLabelSpan = document.getElementById("dupLabel");
const dup_th_word = document.getElementById("dup_th_word");
const dup_th_count = document.getElementById("dup_th_count");

// ----------------------
// Case functions & Stats
// ----------------------
function sentenceCase(t){ t=t.toLowerCase(); return t.replace(/(^\s*[a-z])|([.!?]\s*[a-z])/g,m=>m.toUpperCase()); }
function lower(t){ return t.toLowerCase(); }
function upper(t){ return t.toUpperCase(); }
function capital(t){ return t.replace(/\b(\w)(\w*)/g,(_,a,b)=>a.toUpperCase()+b.toLowerCase()); }
function toggleCase(t){ return t.split("").map(c=>c===c.toUpperCase()?c.toLowerCase():c.toUpperCase()).join(""); }
function applyCase(text){ switch(sel.value){ case"sentence":return sentenceCase(text); case"lower":return lower(text); case"upper":return upper(text); case"capital":return capital(text); case"toggle":return toggleCase(text);} return text; }

function updateStats(){ const t = txt.value;
  s_chars.textContent = t.length;
  s_words.textContent = t.trim() ? t.trim().split(/\s+/).length : 0;
  s_sent.textContent = t.split(/[.!?]+/).filter(Boolean).length;
  s_para.textContent = t.split(/\n+/).filter(Boolean).length;
  s_space.textContent = (t.match(/ /g)||[]).length;
  charBox.textContent = t.length + " characters";
  updateDuplicates(t);
}

function highlightDuplicates(text){
  const words = text.toLowerCase().match(/\b\w+\b/g) || [];
  const counts = {}; words.forEach(w=>counts[w]=(counts[w]||0)+1);
  let highlighted = text.replace(/\b\w+\b/g, word=>{ return counts[word.toLowerCase()]>1 ? `<mark style="background:yellow;color:black;">${word}</mark>` : word; });
  highlighted = highlighted.replace(/\n/g,'<br>').replace(/ /g,'&nbsp;');
  highlightLayer.innerHTML = highlighted;
}

function updateDuplicates(text){
  const words = text.toLowerCase().match(/\b\w+\b/g) || [];
  const counts = {}; words.forEach(w=>counts[w]=(counts[w]||0)+1);
  const duplicates = Object.keys(counts).filter(k=>counts[k]>1);
  dup_count.textContent = duplicates.length;
  dup_table.innerHTML = "";
  if(duplicates.length){
    duplicates.forEach(w=>{
      const tr = document.createElement("tr");
      const tdW = document.createElement("td"); tdW.textContent = w;
      const tdC = document.createElement("td"); tdC.textContent = counts[w];
      tr.appendChild(tdW); tr.appendChild(tdC);
      dup_table.appendChild(tr);
    });
  } else {
    const tr = document.createElement("tr");
    const td = document.createElement("td"); td.colSpan = 2; td.textContent = translations[currentLang].dupTable.nodups;
    tr.appendChild(td); dup_table.appendChild(tr);
  }
  highlightDuplicates(text);
}

// ----------------------
// Event listeners
// ----------------------
sel.addEventListener("change", ()=>{ txt.value=applyCase(txt.value); updateStats(); });
txt.addEventListener("input", ()=>updateStats());
clearBtn.addEventListener("click", ()=>{ txt.value=""; updateStats(); });
darkToggle.addEventListener("change", ()=>{ if(darkToggle.checked) document.body.classList.add("dark"); else document.body.classList.remove("dark"); });

copyBtn.addEventListener("click", ()=>{
  navigator.clipboard.writeText(txt.value);
  copyTooltip.textContent = translations[currentLang].copyTooltip;
  copyTooltip.classList.add("show");
  setTimeout(()=>copyTooltip.classList.remove("show"),2000);
});

// ----------------------
// Google Translate Integration
// ----------------------
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
      pageLanguage:'en',
      includedLanguages:'en,es,fr,de,hi,zh-CN,ja,ru,ar,pt',
      layout:google.translate.TranslateElement.InlineLayout.SIMPLE
  }, 'google_translate_element');
}
(function(){
  var gtScript = document.createElement('script');
  gtScript.src = "//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
  gtScript.type = "text/javascript";
  document.head.appendChild(gtScript);
})();

// ----------------------
// Language system with automatic Google Translate
// ----------------------
let currentLang = localStorage.getItem('utl_lang')||'en';
langSelectHeader.value = currentLang;

function applyTranslations(lang){
  currentLang = translations[lang]?lang:'en';
  localStorage.setItem('utl_lang',currentLang);
  const t = translations[currentLang];

  headerTitle.textContent = t.headerTitle;
  txt.placeholder = t.placeholder;
  clearBtn.textContent = t.clearBtn;
  copyBtn.textContent = t.copyBtn;
  downloadBtn.textContent = t.downloadBtn;
  darkLabelSpan.textContent = t.darkLabel;

  const caseMap=t.caseOptions;
  Array.from(sel.options).forEach(opt=>{ if(caseMap[opt.value]) opt.textContent=caseMap[opt.value]; });
  Array.from(downloadFormat.options).forEach(opt=>{ if(t.downloadOptions[opt.value]) opt.textContent=t.downloadOptions[opt.value]; });
  
  label_chars.childNodes[0]&&(label_chars.childNodes[0].nodeValue=t.stats.chars+" ");
  label_words.childNodes[0]&&(label_words.childNodes[0].nodeValue=t.stats.words+" ");
  label_sent.childNodes[0]&&(label_sent.childNodes[0].nodeValue=t.stats.sent+" ");
  label_para.childNodes[0]&&(label_para.childNodes[0].nodeValue=t.stats.para+" ");
  label_space.childNodes[0]&&(label_space.childNodes[0].nodeValue=t.stats.space+" ");
  
  dupLabelSpan.childNodes[0]&&(dupLabelSpan.childNodes[0].nodeValue=t.dupLabel+" ");
  dup_th_word.textContent=t.dupTable.word;
  dup_th_count.textContent=t.dupTable.count;
  copyTooltip.textContent=t.copyTooltip;

  // Trigger Google Translate
  const select = document.querySelector(".goog-te-combo");
  if(select){
    select.value = lang;
    select.dispatchEvent(new Event('change'));
  }
}

langSelectHeader.addEventListener("change", (e)=>{
  applyTranslations(e.target.value);
});

applyTranslations(currentLang);
updateStats();
</script>
</body>
</html>
